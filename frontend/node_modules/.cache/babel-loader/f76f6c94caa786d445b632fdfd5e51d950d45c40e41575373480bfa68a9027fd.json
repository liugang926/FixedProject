{"ast":null,"code":"import _objectSpread from \"C:/Users/ND/Desktop/Fixed_Project/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _toConsumableArray from \"C:/Users/ND/Desktop/Fixed_Project/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.is-array.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.some.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\n// import Layout from '@/views/layout/Layout.vue'\nimport { asyncRoutes, constantRoutes } from '@/router';\nvar state = {\n  routes: [],\n  addRoutes: []\n};\nvar mutations = {\n  SET_ROUTES: function SET_ROUTES(state, routes) {\n    state.addRoutes = routes;\n    state.routes = constantRoutes.concat(routes);\n  }\n};\nvar actions = {\n  generateRoutes: function generateRoutes(_ref) {\n    var commit = _ref.commit;\n    var roles = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ['user'];\n    return new Promise(function (resolve) {\n      var accessedRoutes = [];\n\n      // 确保 roles 是数组\n      var userRoles = Array.isArray(roles) ? roles : [roles];\n      if (userRoles.includes('admin')) {\n        accessedRoutes = _toConsumableArray(asyncRoutes); // 使用扩展运算符创建副本\n      } else {\n        accessedRoutes = filterAsyncRoutes(asyncRoutes, userRoles);\n      }\n\n      // 移除 404 路由，确保它在最后\n      var notFoundRoute = accessedRoutes.pop();\n      commit('SET_ROUTES', [].concat(_toConsumableArray(accessedRoutes), [notFoundRoute]));\n      resolve(accessedRoutes);\n    });\n  }\n};\n\n// 过滤路由\nfunction filterAsyncRoutes(routes, roles) {\n  var res = [];\n  routes.forEach(function (route) {\n    var tmp = _objectSpread({}, route);\n    if (hasPermission(roles, tmp)) {\n      if (tmp.children) {\n        tmp.children = filterAsyncRoutes(tmp.children, roles);\n      }\n      res.push(tmp);\n    }\n  });\n  return res;\n}\n\n// 判断是否有权限\nfunction hasPermission(roles, route) {\n  if (route.meta && route.meta.roles) {\n    // 确保 roles 是数组\n    var userRoles = Array.isArray(roles) ? roles : [roles];\n    return userRoles.some(function (role) {\n      return route.meta.roles.includes(role);\n    });\n  }\n  return true;\n}\nexport default {\n  namespaced: true,\n  state: state,\n  mutations: mutations,\n  actions: actions\n};","map":{"version":3,"names":["asyncRoutes","constantRoutes","state","routes","addRoutes","mutations","SET_ROUTES","concat","actions","generateRoutes","_ref","commit","roles","arguments","length","undefined","Promise","resolve","accessedRoutes","userRoles","Array","isArray","includes","_toConsumableArray","filterAsyncRoutes","notFoundRoute","pop","res","forEach","route","tmp","_objectSpread","hasPermission","children","push","meta","some","role","namespaced"],"sources":["C:/Users/ND/Desktop/Fixed_Project/frontend/src/store/modules/permission.js"],"sourcesContent":["// import Layout from '@/views/layout/Layout.vue'\r\nimport { asyncRoutes, constantRoutes } from '@/router'\r\n\r\nconst state = {\r\n  routes: [],\r\n  addRoutes: []\r\n}\r\n\r\nconst mutations = {\r\n  SET_ROUTES: (state, routes) => {\r\n    state.addRoutes = routes\r\n    state.routes = constantRoutes.concat(routes)\r\n  }\r\n}\r\n\r\nconst actions = {\r\n  generateRoutes({ commit }, roles = ['user']) {\r\n    return new Promise(resolve => {\r\n      let accessedRoutes = []\r\n      \r\n      // 确保 roles 是数组\r\n      const userRoles = Array.isArray(roles) ? roles : [roles]\r\n      \r\n      if (userRoles.includes('admin')) {\r\n        accessedRoutes = [...asyncRoutes]  // 使用扩展运算符创建副本\r\n      } else {\r\n        accessedRoutes = filterAsyncRoutes(asyncRoutes, userRoles)\r\n      }\r\n      \r\n      // 移除 404 路由，确保它在最后\r\n      const notFoundRoute = accessedRoutes.pop()\r\n      commit('SET_ROUTES', [...accessedRoutes, notFoundRoute])\r\n      resolve(accessedRoutes)\r\n    })\r\n  }\r\n}\r\n\r\n// 过滤路由\r\nfunction filterAsyncRoutes(routes, roles) {\r\n  const res = []\r\n\r\n  routes.forEach(route => {\r\n    const tmp = { ...route }\r\n    if (hasPermission(roles, tmp)) {\r\n      if (tmp.children) {\r\n        tmp.children = filterAsyncRoutes(tmp.children, roles)\r\n      }\r\n      res.push(tmp)\r\n    }\r\n  })\r\n\r\n  return res\r\n}\r\n\r\n// 判断是否有权限\r\nfunction hasPermission(roles, route) {\r\n  if (route.meta && route.meta.roles) {\r\n    // 确保 roles 是数组\r\n    const userRoles = Array.isArray(roles) ? roles : [roles]\r\n    return userRoles.some(role => route.meta.roles.includes(role))\r\n  }\r\n  return true\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  mutations,\r\n  actions\r\n} "],"mappings":";;;;;;;;;;;;;;AAAA;AACA,SAASA,WAAW,EAAEC,cAAc,QAAQ,UAAU;AAEtD,IAAMC,KAAK,GAAG;EACZC,MAAM,EAAE,EAAE;EACVC,SAAS,EAAE;AACb,CAAC;AAED,IAAMC,SAAS,GAAG;EAChBC,UAAU,EAAE,SAAZA,UAAUA,CAAGJ,KAAK,EAAEC,MAAM,EAAK;IAC7BD,KAAK,CAACE,SAAS,GAAGD,MAAM;IACxBD,KAAK,CAACC,MAAM,GAAGF,cAAc,CAACM,MAAM,CAACJ,MAAM,CAAC;EAC9C;AACF,CAAC;AAED,IAAMK,OAAO,GAAG;EACdC,cAAc,WAAdA,cAAcA,CAAAC,IAAA,EAA+B;IAAA,IAA5BC,MAAM,GAAAD,IAAA,CAANC,MAAM;IAAA,IAAIC,KAAK,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,MAAM,CAAC;IACzC,OAAO,IAAIG,OAAO,CAAC,UAAAC,OAAO,EAAI;MAC5B,IAAIC,cAAc,GAAG,EAAE;;MAEvB;MACA,IAAMC,SAAS,GAAGC,KAAK,CAACC,OAAO,CAACT,KAAK,CAAC,GAAGA,KAAK,GAAG,CAACA,KAAK,CAAC;MAExD,IAAIO,SAAS,CAACG,QAAQ,CAAC,OAAO,CAAC,EAAE;QAC/BJ,cAAc,GAAAK,kBAAA,CAAOvB,WAAW,CAAC,EAAE;MACrC,CAAC,MAAM;QACLkB,cAAc,GAAGM,iBAAiB,CAACxB,WAAW,EAAEmB,SAAS,CAAC;MAC5D;;MAEA;MACA,IAAMM,aAAa,GAAGP,cAAc,CAACQ,GAAG,CAAC,CAAC;MAC1Cf,MAAM,CAAC,YAAY,KAAAJ,MAAA,CAAAgB,kBAAA,CAAML,cAAc,IAAEO,aAAa,EAAC,CAAC;MACxDR,OAAO,CAACC,cAAc,CAAC;IACzB,CAAC,CAAC;EACJ;AACF,CAAC;;AAED;AACA,SAASM,iBAAiBA,CAACrB,MAAM,EAAES,KAAK,EAAE;EACxC,IAAMe,GAAG,GAAG,EAAE;EAEdxB,MAAM,CAACyB,OAAO,CAAC,UAAAC,KAAK,EAAI;IACtB,IAAMC,GAAG,GAAAC,aAAA,KAAQF,KAAK,CAAE;IACxB,IAAIG,aAAa,CAACpB,KAAK,EAAEkB,GAAG,CAAC,EAAE;MAC7B,IAAIA,GAAG,CAACG,QAAQ,EAAE;QAChBH,GAAG,CAACG,QAAQ,GAAGT,iBAAiB,CAACM,GAAG,CAACG,QAAQ,EAAErB,KAAK,CAAC;MACvD;MACAe,GAAG,CAACO,IAAI,CAACJ,GAAG,CAAC;IACf;EACF,CAAC,CAAC;EAEF,OAAOH,GAAG;AACZ;;AAEA;AACA,SAASK,aAAaA,CAACpB,KAAK,EAAEiB,KAAK,EAAE;EACnC,IAAIA,KAAK,CAACM,IAAI,IAAIN,KAAK,CAACM,IAAI,CAACvB,KAAK,EAAE;IAClC;IACA,IAAMO,SAAS,GAAGC,KAAK,CAACC,OAAO,CAACT,KAAK,CAAC,GAAGA,KAAK,GAAG,CAACA,KAAK,CAAC;IACxD,OAAOO,SAAS,CAACiB,IAAI,CAAC,UAAAC,IAAI;MAAA,OAAIR,KAAK,CAACM,IAAI,CAACvB,KAAK,CAACU,QAAQ,CAACe,IAAI,CAAC;IAAA,EAAC;EAChE;EACA,OAAO,IAAI;AACb;AAEA,eAAe;EACbC,UAAU,EAAE,IAAI;EAChBpC,KAAK,EAALA,KAAK;EACLG,SAAS,EAATA,SAAS;EACTG,OAAO,EAAPA;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}