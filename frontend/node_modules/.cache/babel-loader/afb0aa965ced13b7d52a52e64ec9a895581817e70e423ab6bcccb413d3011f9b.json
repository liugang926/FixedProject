{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.is-array.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport { login as _login, logout as _logout, getInfo as _getInfo } from '@/api/user';\nimport { getToken, setToken, getUserInfo, setUserInfo, clearAuth } from '@/utils/auth';\nimport { resetRouter } from '@/router';\nvar getDefaultState = function getDefaultState() {\n  var userInfo = getUserInfo();\n  return {\n    token: getToken(),\n    name: (userInfo === null || userInfo === void 0 ? void 0 : userInfo.name) || '',\n    avatar: (userInfo === null || userInfo === void 0 ? void 0 : userInfo.avatar) || '',\n    roles: (userInfo === null || userInfo === void 0 ? void 0 : userInfo.roles) || [],\n    permissions: (userInfo === null || userInfo === void 0 ? void 0 : userInfo.permissions) || []\n  };\n};\nvar state = getDefaultState();\nvar mutations = {\n  RESET_STATE: function RESET_STATE(state) {\n    Object.assign(state, getDefaultState());\n  },\n  SET_TOKEN: function SET_TOKEN(state, token) {\n    state.token = token;\n  },\n  SET_NAME: function SET_NAME(state, name) {\n    state.name = name;\n  },\n  SET_AVATAR: function SET_AVATAR(state, avatar) {\n    state.avatar = avatar;\n  },\n  SET_ROLES: function SET_ROLES(state, roles) {\n    state.roles = Array.isArray(roles) ? roles : [roles].filter(Boolean);\n  },\n  SET_PERMISSIONS: function SET_PERMISSIONS(state, permissions) {\n    state.permissions = Array.isArray(permissions) ? permissions : [permissions].filter(Boolean);\n  }\n};\nvar actions = {\n  // 用户登录\n  login: function login(_ref, userInfo) {\n    var commit = _ref.commit;\n    var username = userInfo.username,\n      password = userInfo.password;\n    return new Promise(function (resolve, reject) {\n      _login({\n        username: username.trim(),\n        password: password\n      }).then(function (response) {\n        var token = response.token;\n        commit('SET_TOKEN', token);\n        setToken(token);\n        resolve();\n      })[\"catch\"](function (error) {\n        reject(error);\n      });\n    });\n  },\n  // 获取用户信息\n  getInfo: function getInfo(_ref2) {\n    var commit = _ref2.commit;\n    return new Promise(function (resolve, reject) {\n      _getInfo().then(function (response) {\n        var role = response.role,\n          name = response.name,\n          avatar = response.avatar,\n          permissions = response.permissions;\n        if (!role) {\n          reject(new Error('获取用户信息失败，请重新登录'));\n          return;\n        }\n        var roles = Array.isArray(role) ? role : [role].filter(Boolean);\n        commit('SET_ROLES', roles);\n        commit('SET_NAME', name);\n        commit('SET_AVATAR', avatar);\n        commit('SET_PERMISSIONS', permissions);\n\n        // 保存用户信息到本地存储\n        setUserInfo({\n          name: name,\n          avatar: avatar,\n          roles: roles,\n          permissions: permissions\n        });\n        resolve({\n          roles: roles,\n          permissions: permissions\n        });\n      })[\"catch\"](function (error) {\n        reject(error);\n      });\n    });\n  },\n  // 用户登出\n  logout: function logout(_ref3) {\n    var commit = _ref3.commit;\n    return new Promise(function (resolve, reject) {\n      _logout().then(function () {\n        clearAuth();\n        commit('RESET_STATE');\n        resetRouter();\n        resolve();\n      })[\"catch\"](function (error) {\n        reject(error);\n      });\n    });\n  },\n  // 重置 token\n  resetToken: function resetToken(_ref4) {\n    var commit = _ref4.commit;\n    return new Promise(function (resolve) {\n      clearAuth();\n      commit('RESET_STATE');\n      resolve();\n    });\n  }\n};\nexport default {\n  namespaced: true,\n  state: state,\n  mutations: mutations,\n  actions: actions\n};","map":{"version":3,"names":["login","logout","getInfo","getToken","setToken","getUserInfo","setUserInfo","clearAuth","resetRouter","getDefaultState","userInfo","token","name","avatar","roles","permissions","state","mutations","RESET_STATE","Object","assign","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","Array","isArray","filter","Boolean","SET_PERMISSIONS","actions","_ref","commit","username","password","Promise","resolve","reject","trim","then","response","error","_ref2","role","Error","_ref3","resetToken","_ref4","namespaced"],"sources":["C:/Users/ND/Desktop/Fixed_Project/frontend/src/store/modules/user.js"],"sourcesContent":["import { login, logout, getInfo } from '@/api/user'\r\nimport { getToken, setToken, getUserInfo, setUserInfo, clearAuth } from '@/utils/auth'\r\nimport { resetRouter } from '@/router'\r\n\r\nconst getDefaultState = () => {\r\n  const userInfo = getUserInfo()\r\n  return {\r\n    token: getToken(),\r\n    name: userInfo?.name || '',\r\n    avatar: userInfo?.avatar || '',\r\n    roles: userInfo?.roles || [],\r\n    permissions: userInfo?.permissions || []\r\n  }\r\n}\r\n\r\nconst state = getDefaultState()\r\n\r\nconst mutations = {\r\n  RESET_STATE: (state) => {\r\n    Object.assign(state, getDefaultState())\r\n  },\r\n  SET_TOKEN: (state, token) => {\r\n    state.token = token\r\n  },\r\n  SET_NAME: (state, name) => {\r\n    state.name = name\r\n  },\r\n  SET_AVATAR: (state, avatar) => {\r\n    state.avatar = avatar\r\n  },\r\n  SET_ROLES: (state, roles) => {\r\n    state.roles = Array.isArray(roles) ? roles : [roles].filter(Boolean)\r\n  },\r\n  SET_PERMISSIONS: (state, permissions) => {\r\n    state.permissions = Array.isArray(permissions) ? permissions : [permissions].filter(Boolean)\r\n  }\r\n}\r\n\r\nconst actions = {\r\n  // 用户登录\r\n  login({ commit }, userInfo) {\r\n    const { username, password } = userInfo\r\n    return new Promise((resolve, reject) => {\r\n      login({ username: username.trim(), password: password })\r\n        .then(response => {\r\n          const { token } = response\r\n          commit('SET_TOKEN', token)\r\n          setToken(token)\r\n          resolve()\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 获取用户信息\r\n  getInfo({ commit }) {\r\n    return new Promise((resolve, reject) => {\r\n      getInfo()\r\n        .then(response => {\r\n          const { role, name, avatar, permissions } = response\r\n\r\n          if (!role) {\r\n            reject(new Error('获取用户信息失败，请重新登录'))\r\n            return\r\n          }\r\n\r\n          const roles = Array.isArray(role) ? role : [role].filter(Boolean)\r\n          \r\n          commit('SET_ROLES', roles)\r\n          commit('SET_NAME', name)\r\n          commit('SET_AVATAR', avatar)\r\n          commit('SET_PERMISSIONS', permissions)\r\n\r\n          // 保存用户信息到本地存储\r\n          setUserInfo({\r\n            name,\r\n            avatar,\r\n            roles,\r\n            permissions\r\n          })\r\n\r\n          resolve({ roles, permissions })\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 用户登出\r\n  logout({ commit }) {\r\n    return new Promise((resolve, reject) => {\r\n      logout()\r\n        .then(() => {\r\n          clearAuth()\r\n          commit('RESET_STATE')\r\n          resetRouter()\r\n          resolve()\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 重置 token\r\n  resetToken({ commit }) {\r\n    return new Promise(resolve => {\r\n      clearAuth()\r\n      commit('RESET_STATE')\r\n      resolve()\r\n    })\r\n  }\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  mutations,\r\n  actions\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}