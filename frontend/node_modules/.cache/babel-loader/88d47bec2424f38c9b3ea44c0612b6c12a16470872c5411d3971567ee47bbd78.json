{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/ND/Desktop/Fixed_Project/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _objectSpread from \"C:/Users/ND/Desktop/Fixed_Project/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"C:/Users/ND/Desktop/Fixed_Project/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.is-array.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport { createRouter, createWebHistory } from 'vue-router';\nimport Layout from '@/views/layout/Layout.vue';\nimport { getToken } from '@/utils/auth';\nimport store from '@/store';\n\n// 基础路由\nexport var constantRoutes = [{\n  path: '/login',\n  name: 'Login',\n  component: function component() {\n    return import('@/views/login/Login.vue');\n  },\n  meta: {\n    title: '登录'\n  },\n  hidden: true\n}, {\n  path: '/404',\n  component: function component() {\n    return import('@/views/error/404.vue');\n  },\n  meta: {\n    title: '404'\n  },\n  hidden: true\n}, {\n  path: '/',\n  component: Layout,\n  redirect: '/dashboard',\n  meta: {\n    title: '主页'\n  },\n  children: [{\n    path: 'dashboard',\n    name: 'Dashboard',\n    component: function component() {\n      return import('@/views/dashboard/Dashboard.vue');\n    },\n    meta: {\n      title: '仪表盘',\n      icon: 'Menu',\n      cache: true,\n      affix: true\n    }\n  }]\n}];\n\n// 需要根据权限动态加载的路由\nexport var asyncRoutes = [{\n  path: '/assets',\n  component: Layout,\n  meta: {\n    title: '资产管理'\n  },\n  children: [{\n    path: 'index',\n    name: 'Assets',\n    component: function component() {\n      return import('@/views/assets/AssetList.vue');\n    },\n    meta: {\n      title: '资产管理',\n      icon: 'Document',\n      roles: ['admin', 'user']\n    }\n  }]\n}, {\n  path: '/users',\n  component: Layout,\n  meta: {\n    title: '用户管理'\n  },\n  children: [{\n    path: 'index',\n    name: 'Users',\n    component: function component() {\n      return import('@/views/user/index.vue');\n    },\n    meta: {\n      title: '用户管理',\n      icon: 'User',\n      roles: ['admin']\n    }\n  }]\n}, {\n  path: '/:pathMatch(.*)*',\n  redirect: '/404',\n  hidden: true\n}];\nvar router = createRouter({\n  history: createWebHistory(),\n  // 移除基础路径\n  routes: constantRoutes,\n  scrollBehavior: function scrollBehavior() {\n    return {\n      top: 0\n    };\n  } // 添加滚动行为\n});\nexport function resetRouter() {\n  var newRouter = createRouter({\n    history: createWebHistory(),\n    routes: constantRoutes\n  });\n  router.matcher = newRouter.matcher;\n}\nrouter.beforeEach(/*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(to, from, next) {\n    var hasToken, roles, hasRoles, _yield$store$dispatch, _roles, userRoles, accessRoutes;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          // 添加调试日志\n          console.log('Route change:', {\n            to: to.fullPath,\n            from: from.fullPath,\n            hasToken: !!getToken()\n          });\n          hasToken = getToken();\n          if (!hasToken) {\n            _context.next = 34;\n            break;\n          }\n          if (!(to.path === '/login')) {\n            _context.next = 7;\n            break;\n          }\n          next({\n            path: '/'\n          });\n          _context.next = 32;\n          break;\n        case 7:\n          _context.prev = 7;\n          roles = store.state.user.roles || [];\n          hasRoles = Array.isArray(roles) && roles.length > 0;\n          if (!hasRoles) {\n            _context.next = 14;\n            break;\n          }\n          next();\n          _context.next = 24;\n          break;\n        case 14:\n          _context.next = 16;\n          return store.dispatch('user/getInfo');\n        case 16:\n          _yield$store$dispatch = _context.sent;\n          _roles = _yield$store$dispatch.roles;\n          userRoles = Array.isArray(_roles) ? _roles : [_roles];\n          _context.next = 21;\n          return store.dispatch('permission/generateRoutes', userRoles);\n        case 21:\n          accessRoutes = _context.sent;\n          accessRoutes.forEach(function (route) {\n            router.addRoute(route);\n          });\n          next(_objectSpread(_objectSpread({}, to), {}, {\n            replace: true\n          }));\n        case 24:\n          _context.next = 32;\n          break;\n        case 26:\n          _context.prev = 26;\n          _context.t0 = _context[\"catch\"](7);\n          console.error('Route Error:', _context.t0);\n          _context.next = 31;\n          return store.dispatch('user/resetToken');\n        case 31:\n          next(\"/login?redirect=\".concat(to.path));\n        case 32:\n          _context.next = 35;\n          break;\n        case 34:\n          if (to.path === '/login') {\n            next();\n          } else {\n            next(\"/login?redirect=\".concat(to.path));\n          }\n        case 35:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee, null, [[7, 26]]);\n  }));\n  return function (_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}());\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","Layout","getToken","store","constantRoutes","path","name","component","meta","title","hidden","redirect","children","icon","cache","affix","asyncRoutes","roles","router","history","routes","scrollBehavior","top","resetRouter","newRouter","matcher","beforeEach","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","to","from","next","hasToken","hasRoles","_yield$store$dispatch","_roles","userRoles","accessRoutes","wrap","_callee$","_context","prev","console","log","fullPath","state","user","Array","isArray","length","dispatch","sent","forEach","route","addRoute","_objectSpread","replace","t0","error","concat","stop","_x","_x2","_x3","apply","arguments"],"sources":["C:/Users/ND/Desktop/Fixed_Project/frontend/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\r\nimport Layout from '@/views/layout/Layout.vue'\r\nimport { getToken } from '@/utils/auth'\r\nimport store from '@/store'\r\n\r\n// 基础路由\r\nexport const constantRoutes = [\r\n  {\r\n    path: '/login',\r\n    name: 'Login',\r\n    component: () => import('@/views/login/Login.vue'),\r\n    meta: { title: '登录' },\r\n    hidden: true\r\n  },\r\n  {\r\n    path: '/404',\r\n    component: () => import('@/views/error/404.vue'),\r\n    meta: { title: '404' },\r\n    hidden: true\r\n  },\r\n  {\r\n    path: '/',\r\n    component: Layout,\r\n    redirect: '/dashboard',\r\n    meta: { title: '主页' },\r\n    children: [\r\n      {\r\n        path: 'dashboard',\r\n        name: 'Dashboard',\r\n        component: () => import('@/views/dashboard/Dashboard.vue'),\r\n        meta: { title: '仪表盘', icon: 'Menu', cache: true, affix: true }\r\n      }\r\n    ]\r\n  }\r\n]\r\n\r\n// 需要根据权限动态加载的路由\r\nexport const asyncRoutes = [\r\n  {\r\n    path: '/assets',\r\n    component: Layout,\r\n    meta: { title: '资产管理' },\r\n    children: [\r\n      {\r\n        path: 'index',\r\n        name: 'Assets',\r\n        component: () => import('@/views/assets/AssetList.vue'),\r\n        meta: { title: '资产管理', icon: 'Document', roles: ['admin', 'user'] }\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    path: '/users',\r\n    component: Layout,\r\n    meta: { title: '用户管理' },\r\n    children: [\r\n      {\r\n        path: 'index',\r\n        name: 'Users',\r\n        component: () => import('@/views/user/index.vue'),\r\n        meta: { title: '用户管理', icon: 'User', roles: ['admin'] }\r\n      }\r\n    ]\r\n  },\r\n  { path: '/:pathMatch(.*)*', redirect: '/404', hidden: true }\r\n]\r\n\r\nconst router = createRouter({\r\n  history: createWebHistory(),  // 移除基础路径\r\n  routes: constantRoutes,\r\n  scrollBehavior: () => ({ top: 0 })  // 添加滚动行为\r\n})\r\n\r\nexport function resetRouter() {\r\n  const newRouter = createRouter({\r\n    history: createWebHistory(),\r\n    routes: constantRoutes\r\n  })\r\n  router.matcher = newRouter.matcher\r\n}\r\n\r\nrouter.beforeEach(async (to, from, next) => {\r\n  // 添加调试日志\r\n  console.log('Route change:', {\r\n    to: to.fullPath,\r\n    from: from.fullPath,\r\n    hasToken: !!getToken()\r\n  })\r\n\r\n  const hasToken = getToken()\r\n\r\n  if (hasToken) {\r\n    if (to.path === '/login') {\r\n      next({ path: '/' })\r\n    } else {\r\n      try {\r\n        const roles = store.state.user.roles || []\r\n        const hasRoles = Array.isArray(roles) && roles.length > 0\r\n\r\n        if (hasRoles) {\r\n          next()\r\n        } else {\r\n          const { roles } = await store.dispatch('user/getInfo')\r\n          const userRoles = Array.isArray(roles) ? roles : [roles]\r\n          const accessRoutes = await store.dispatch('permission/generateRoutes', userRoles)\r\n          \r\n          accessRoutes.forEach(route => {\r\n            router.addRoute(route)\r\n          })\r\n\r\n          next({ ...to, replace: true })\r\n        }\r\n      } catch (error) {\r\n        console.error('Route Error:', error)\r\n        await store.dispatch('user/resetToken')\r\n        next(`/login?redirect=${to.path}`)\r\n      }\r\n    }\r\n  } else {\r\n    if (to.path === '/login') {\r\n      next()\r\n    } else {\r\n      next(`/login?redirect=${to.path}`)\r\n    }\r\n  }\r\n})\r\n\r\nexport default router "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}