{"ast":null,"code":"import \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport { login as _login, getInfo as _getInfo } from '@/api/user';\nimport { getToken, setToken, removeToken } from '@/utils/auth';\nimport { resetRouter } from '@/router';\nimport { getPermissions, setPermissions, getRoles, setRoles, clearPermissionCache } from '@/utils/permission-cache';\nvar getDefaultState = function getDefaultState() {\n  return {\n    token: getToken(),\n    name: '',\n    avatar: '',\n    roles: getRoles(),\n    permissions: getPermissions()\n  };\n};\nvar state = getDefaultState();\nvar mutations = {\n  RESET_STATE: function RESET_STATE(state) {\n    Object.assign(state, getDefaultState());\n  },\n  SET_TOKEN: function SET_TOKEN(state, token) {\n    state.token = token;\n  },\n  SET_NAME: function SET_NAME(state, name) {\n    state.name = name;\n  },\n  SET_AVATAR: function SET_AVATAR(state, avatar) {\n    state.avatar = avatar;\n  },\n  SET_ROLES: function SET_ROLES(state, roles) {\n    state.roles = roles;\n    setRoles(roles);\n  },\n  SET_PERMISSIONS: function SET_PERMISSIONS(state, permissions) {\n    state.permissions = permissions;\n    setPermissions(permissions);\n  }\n};\nvar actions = {\n  // 用户登录\n  login: function login(_ref, userInfo) {\n    var commit = _ref.commit;\n    var username = userInfo.username,\n      password = userInfo.password;\n    return new Promise(function (resolve, reject) {\n      _login({\n        username: username.trim(),\n        password: password\n      }).then(function (response) {\n        var token = response.token,\n          user = response.user;\n        commit('SET_TOKEN', token);\n        commit('SET_NAME', user.name);\n        commit('SET_AVATAR', user.avatar);\n        commit('SET_ROLES', user.roles);\n        commit('SET_PERMISSIONS', user.permissions);\n        setToken(token);\n        resolve(user);\n      })[\"catch\"](function (error) {\n        reject(error);\n      });\n    });\n  },\n  // 获取用户信息\n  getInfo: function getInfo(_ref2) {\n    var commit = _ref2.commit;\n    return new Promise(function (resolve, reject) {\n      _getInfo().then(function (response) {\n        var roles = response.roles,\n          permissions = response.permissions,\n          name = response.name,\n          avatar = response.avatar;\n        if (!roles || roles.length <= 0) {\n          reject('用户角色必须是非空数组!');\n        }\n        commit('SET_ROLES', roles);\n        commit('SET_NAME', name);\n        commit('SET_AVATAR', avatar);\n        commit('SET_PERMISSIONS', permissions);\n        resolve(response);\n      })[\"catch\"](function (error) {\n        reject(error);\n      });\n    });\n  },\n  // 用户登出\n  logout: function (_logout) {\n    function logout(_x) {\n      return _logout.apply(this, arguments);\n    }\n    logout.toString = function () {\n      return _logout.toString();\n    };\n    return logout;\n  }(function (_ref3) {\n    var commit = _ref3.commit;\n    return new Promise(function (resolve, reject) {\n      logout().then(function () {\n        removeToken();\n        resetRouter();\n        clearPermissionCache();\n        commit('RESET_STATE');\n        resolve();\n      })[\"catch\"](function (error) {\n        reject(error);\n      });\n    });\n  }),\n  // 重置 token\n  resetToken: function resetToken(_ref4) {\n    var commit = _ref4.commit;\n    return new Promise(function (resolve) {\n      removeToken();\n      commit('RESET_STATE');\n      resolve();\n    });\n  }\n};\nexport default {\n  namespaced: true,\n  state: state,\n  mutations: mutations,\n  actions: actions\n};","map":{"version":3,"names":["login","getInfo","getToken","setToken","removeToken","resetRouter","getPermissions","setPermissions","getRoles","setRoles","clearPermissionCache","getDefaultState","token","name","avatar","roles","permissions","state","mutations","RESET_STATE","Object","assign","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","SET_PERMISSIONS","actions","_ref","userInfo","commit","username","password","Promise","resolve","reject","trim","then","response","user","error","_ref2","length","logout","_logout","_x","apply","arguments","toString","_ref3","resetToken","_ref4","namespaced"],"sources":["C:/Users/ND/Desktop/Fixed_Project/frontend/src/store/modules/user.js"],"sourcesContent":["import { login, getInfo } from '@/api/user'\r\nimport { getToken, setToken, removeToken } from '@/utils/auth'\r\nimport { resetRouter } from '@/router'\r\nimport { \r\n  getPermissions, \r\n  setPermissions, \r\n  getRoles, \r\n  setRoles, \r\n  clearPermissionCache \r\n} from '@/utils/permission-cache'\r\n\r\nconst getDefaultState = () => {\r\n  return {\r\n    token: getToken(),\r\n    name: '',\r\n    avatar: '',\r\n    roles: getRoles(),\r\n    permissions: getPermissions()\r\n  }\r\n}\r\n\r\nconst state = getDefaultState()\r\n\r\nconst mutations = {\r\n  RESET_STATE: (state) => {\r\n    Object.assign(state, getDefaultState())\r\n  },\r\n  SET_TOKEN: (state, token) => {\r\n    state.token = token\r\n  },\r\n  SET_NAME: (state, name) => {\r\n    state.name = name\r\n  },\r\n  SET_AVATAR: (state, avatar) => {\r\n    state.avatar = avatar\r\n  },\r\n  SET_ROLES: (state, roles) => {\r\n    state.roles = roles\r\n    setRoles(roles)\r\n  },\r\n  SET_PERMISSIONS: (state, permissions) => {\r\n    state.permissions = permissions\r\n    setPermissions(permissions)\r\n  }\r\n}\r\n\r\nconst actions = {\r\n  // 用户登录\r\n  login({ commit }, userInfo) {\r\n    const { username, password } = userInfo\r\n    return new Promise((resolve, reject) => {\r\n      login({ username: username.trim(), password: password })\r\n        .then(response => {\r\n          const { token, user } = response\r\n          commit('SET_TOKEN', token)\r\n          commit('SET_NAME', user.name)\r\n          commit('SET_AVATAR', user.avatar)\r\n          commit('SET_ROLES', user.roles)\r\n          commit('SET_PERMISSIONS', user.permissions)\r\n          setToken(token)\r\n          resolve(user)\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 获取用户信息\r\n  getInfo({ commit }) {\r\n    return new Promise((resolve, reject) => {\r\n      getInfo()\r\n        .then(response => {\r\n          const { roles, permissions, name, avatar } = response\r\n\r\n          if (!roles || roles.length <= 0) {\r\n            reject('用户角色必须是非空数组!')\r\n          }\r\n\r\n          commit('SET_ROLES', roles)\r\n          commit('SET_NAME', name)\r\n          commit('SET_AVATAR', avatar)\r\n          commit('SET_PERMISSIONS', permissions)\r\n          resolve(response)\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 用户登出\r\n  logout({ commit }) {\r\n    return new Promise((resolve, reject) => {\r\n      logout().then(() => {\r\n        removeToken()\r\n        resetRouter()\r\n        clearPermissionCache()\r\n        commit('RESET_STATE')\r\n        resolve()\r\n      }).catch(error => {\r\n        reject(error)\r\n      })\r\n    })\r\n  },\r\n\r\n  // 重置 token\r\n  resetToken({ commit }) {\r\n    return new Promise(resolve => {\r\n      removeToken()\r\n      commit('RESET_STATE')\r\n      resolve()\r\n    })\r\n  }\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  mutations,\r\n  actions\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}