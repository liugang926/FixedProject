{"ast":null,"code":"import { login, logout, getInfo } from '@/api/user';\nimport { getToken, setToken, removeToken } from '@/utils/auth';\nconst state = {\n  token: getToken(),\n  name: '',\n  avatar: '',\n  roles: []\n};\nconst mutations = {\n  SET_TOKEN: (state, token) => {\n    state.token = token;\n  },\n  SET_NAME: (state, name) => {\n    state.name = name;\n  },\n  SET_AVATAR: (state, avatar) => {\n    state.avatar = avatar;\n  },\n  SET_ROLES: (state, roles) => {\n    state.roles = roles;\n  }\n};\nconst actions = {\n  // 用户登录\n  login({\n    commit\n  }, userInfo) {\n    const {\n      username,\n      password\n    } = userInfo;\n    return new Promise((resolve, reject) => {\n      login({\n        username: username.trim(),\n        password\n      }).then(response => {\n        const {\n          data\n        } = response;\n        commit('SET_TOKEN', data.token);\n        setToken(data.token);\n        resolve();\n      }).catch(error => {\n        reject(error);\n      });\n    });\n  },\n  // 获取用户信息\n  getInfo({\n    commit,\n    state\n  }) {\n    return new Promise((resolve, reject) => {\n      getInfo(state.token).then(response => {\n        const {\n          data\n        } = response;\n        if (!data) {\n          reject('验证失败，请重新登录');\n        }\n        const {\n          roles,\n          name,\n          avatar\n        } = data;\n        commit('SET_ROLES', roles);\n        commit('SET_NAME', name);\n        commit('SET_AVATAR', avatar);\n        resolve(data);\n      }).catch(error => {\n        reject(error);\n      });\n    });\n  },\n  // 用户登出\n  logout({\n    commit\n  }) {\n    return new Promise((resolve, reject) => {\n      logout().then(() => {\n        commit('SET_TOKEN', '');\n        commit('SET_ROLES', []);\n        removeToken();\n        resolve();\n      }).catch(error => {\n        reject(error);\n      });\n    });\n  },\n  // 重置token\n  resetToken({\n    commit\n  }) {\n    return new Promise(resolve => {\n      commit('SET_TOKEN', '');\n      commit('SET_ROLES', []);\n      removeToken();\n      resolve();\n    });\n  }\n};\nexport default {\n  namespaced: true,\n  state,\n  mutations,\n  actions\n};","map":{"version":3,"names":["login","logout","getInfo","getToken","setToken","removeToken","state","token","name","avatar","roles","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","actions","commit","userInfo","username","password","Promise","resolve","reject","trim","then","response","data","catch","error","resetToken","namespaced"],"sources":["C:/Users/ND/Desktop/Fixed_Project/frontend/src/store/modules/user.js"],"sourcesContent":["import { login, logout, getInfo } from '@/api/user'\r\nimport { getToken, setToken, removeToken } from '@/utils/auth'\r\n\r\nconst state = {\r\n  token: getToken(),\r\n  name: '',\r\n  avatar: '',\r\n  roles: []\r\n}\r\n\r\nconst mutations = {\r\n  SET_TOKEN: (state, token) => {\r\n    state.token = token\r\n  },\r\n  SET_NAME: (state, name) => {\r\n    state.name = name\r\n  },\r\n  SET_AVATAR: (state, avatar) => {\r\n    state.avatar = avatar\r\n  },\r\n  SET_ROLES: (state, roles) => {\r\n    state.roles = roles\r\n  }\r\n}\r\n\r\nconst actions = {\r\n  // 用户登录\r\n  login({ commit }, userInfo) {\r\n    const { username, password } = userInfo\r\n    return new Promise((resolve, reject) => {\r\n      login({ username: username.trim(), password })\r\n        .then(response => {\r\n          const { data } = response\r\n          commit('SET_TOKEN', data.token)\r\n          setToken(data.token)\r\n          resolve()\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 获取用户信息\r\n  getInfo({ commit, state }) {\r\n    return new Promise((resolve, reject) => {\r\n      getInfo(state.token)\r\n        .then(response => {\r\n          const { data } = response\r\n          if (!data) {\r\n            reject('验证失败，请重新登录')\r\n          }\r\n          const { roles, name, avatar } = data\r\n          commit('SET_ROLES', roles)\r\n          commit('SET_NAME', name)\r\n          commit('SET_AVATAR', avatar)\r\n          resolve(data)\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 用户登出\r\n  logout({ commit }) {\r\n    return new Promise((resolve, reject) => {\r\n      logout()\r\n        .then(() => {\r\n          commit('SET_TOKEN', '')\r\n          commit('SET_ROLES', [])\r\n          removeToken()\r\n          resolve()\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 重置token\r\n  resetToken({ commit }) {\r\n    return new Promise(resolve => {\r\n      commit('SET_TOKEN', '')\r\n      commit('SET_ROLES', [])\r\n      removeToken()\r\n      resolve()\r\n    })\r\n  }\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  mutations,\r\n  actions\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}