{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/ND/Desktop/Fixed_Project/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/ND/Desktop/Fixed_Project/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { ElMessage } from 'element-plus';\nexport default {\n  name: 'Login',\n  data: function data() {\n    return {\n      loginForm: {\n        username: '',\n        password: ''\n      },\n      loginRules: {\n        username: [{\n          required: true,\n          message: '请输入用户名',\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          message: '请输入密码',\n          trigger: 'blur'\n        }]\n      },\n      passwordType: 'password',\n      loading: false,\n      redirect: undefined\n    };\n  },\n  watch: {\n    $route: {\n      handler: function handler(route) {\n        this.redirect = route.query && route.query.redirect;\n      },\n      immediate: true\n    }\n  },\n  methods: {\n    handleLogin: function handleLogin() {\n      var _this = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var _yield$_this$$store$d, role, accessRoutes;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return _this.$refs.loginForm.validate();\n            case 3:\n              _this.loading = true;\n\n              // 登录\n              _context.next = 6;\n              return _this.$store.dispatch('user/login', _this.loginForm);\n            case 6:\n              _context.next = 8;\n              return _this.$store.dispatch('user/getInfo');\n            case 8:\n              _yield$_this$$store$d = _context.sent;\n              role = _yield$_this$$store$d.role;\n              _context.next = 12;\n              return _this.$store.dispatch('permission/generateRoutes', {\n                roles: [role]\n              });\n            case 12:\n              accessRoutes = _context.sent;\n              // 动态添加路由\n              accessRoutes.forEach(function (route) {\n                _this.$router.addRoute(route);\n              });\n\n              // 跳转到首页或重定向页面\n              _context.next = 16;\n              return _this.$router.push(_this.redirect || '/');\n            case 16:\n              _context.next = 22;\n              break;\n            case 18:\n              _context.prev = 18;\n              _context.t0 = _context[\"catch\"](0);\n              console.error('Login error:', _context.t0);\n              ElMessage.error(_context.t0.message || '登录失败');\n            case 22:\n              _context.prev = 22;\n              _this.loading = false;\n              return _context.finish(22);\n            case 25:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 18, 22, 25]]);\n      }))();\n    }\n  }\n};","map":{"version":3,"names":["ElMessage","name","data","loginForm","username","password","loginRules","required","message","trigger","passwordType","loading","redirect","undefined","watch","$route","handler","route","query","immediate","methods","handleLogin","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$_this$$store$d","role","accessRoutes","wrap","_callee$","_context","prev","next","$refs","validate","$store","dispatch","sent","roles","forEach","$router","addRoute","push","t0","console","error","finish","stop"],"sources":["C:\\Users\\ND\\Desktop\\Fixed_Project\\frontend\\src\\views\\login\\index.vue"],"sourcesContent":["<template>\r\n  <div class=\"login-container\">\r\n    <el-form\r\n      ref=\"loginForm\"\r\n      :model=\"loginForm\"\r\n      :rules=\"loginRules\"\r\n      class=\"login-form\"\r\n      autocomplete=\"on\"\r\n      label-position=\"left\"\r\n    >\r\n      <div class=\"title-container\">\r\n        <h3 class=\"title\">系统登录</h3>\r\n      </div>\r\n\r\n      <el-form-item prop=\"username\">\r\n        <el-input\r\n          ref=\"username\"\r\n          v-model=\"loginForm.username\"\r\n          placeholder=\"用户名\"\r\n          name=\"username\"\r\n          type=\"text\"\r\n          autocomplete=\"on\"\r\n        />\r\n      </el-form-item>\r\n\r\n      <el-form-item prop=\"password\">\r\n        <el-input\r\n          ref=\"password\"\r\n          v-model=\"loginForm.password\"\r\n          placeholder=\"密码\"\r\n          name=\"password\"\r\n          :type=\"passwordType\"\r\n          autocomplete=\"on\"\r\n          @keyup.enter=\"handleLogin\"\r\n        />\r\n      </el-form-item>\r\n\r\n      <el-button\r\n        :loading=\"loading\"\r\n        type=\"primary\"\r\n        style=\"width: 100%; margin-bottom: 30px\"\r\n        @click.prevent=\"handleLogin\"\r\n      >\r\n        登录\r\n      </el-button>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ElMessage } from 'element-plus'\r\n\r\nexport default {\r\n  name: 'Login',\r\n  data() {\r\n    return {\r\n      loginForm: {\r\n        username: '',\r\n        password: ''\r\n      },\r\n      loginRules: {\r\n        username: [{ required: true, message: '请输入用户名', trigger: 'blur' }],\r\n        password: [{ required: true, message: '请输入密码', trigger: 'blur' }]\r\n      },\r\n      passwordType: 'password',\r\n      loading: false,\r\n      redirect: undefined\r\n    }\r\n  },\r\n  watch: {\r\n    $route: {\r\n      handler: function(route) {\r\n        this.redirect = route.query && route.query.redirect\r\n      },\r\n      immediate: true\r\n    }\r\n  },\r\n  methods: {\r\n    async handleLogin() {\r\n      try {\r\n        await this.$refs.loginForm.validate()\r\n        this.loading = true\r\n        \r\n        // 登录\r\n        await this.$store.dispatch('user/login', this.loginForm)\r\n        \r\n        // 获取用户信息\r\n        const { role } = await this.$store.dispatch('user/getInfo')\r\n        \r\n        // 生成路由\r\n        const accessRoutes = await this.$store.dispatch('permission/generateRoutes', { \r\n          roles: [role]\r\n        })\r\n        \r\n        // 动态添加路由\r\n        accessRoutes.forEach(route => {\r\n          this.$router.addRoute(route)\r\n        })\r\n\r\n        // 跳转到首页或重定向页面\r\n        await this.$router.push(this.redirect || '/')\r\n      } catch (error) {\r\n        console.error('Login error:', error)\r\n        ElMessage.error(error.message || '登录失败')\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.login-container {\r\n  min-height: 100%;\r\n  width: 100%;\r\n  background-color: #2d3a4b;\r\n  overflow: hidden;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.login-form {\r\n  width: 520px;\r\n  max-width: 100%;\r\n  padding: 160px 35px 0;\r\n  margin: 0 auto;\r\n  overflow: hidden;\r\n}\r\n\r\n.title-container {\r\n  position: relative;\r\n  .title {\r\n    font-size: 26px;\r\n    color: #eee;\r\n    margin: 0 auto 40px auto;\r\n    text-align: center;\r\n    font-weight: bold;\r\n  }\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}