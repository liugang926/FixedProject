{"ast":null,"code":"import _objectSpread from \"C:/Users/ND/Desktop/Fixed_Project/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.array.is-array.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport { login as _login, getInfo as _getInfo } from '@/api/user';\nimport { getToken, setToken, removeToken } from '@/utils/auth';\nimport { resetRouter } from '@/router';\nvar getDefaultState = function getDefaultState() {\n  return {\n    token: getToken(),\n    name: '',\n    avatar: '',\n    roles: [] // 初始为空数组\n  };\n};\nvar state = getDefaultState();\nvar mutations = {\n  RESET_STATE: function RESET_STATE(state) {\n    Object.assign(state, getDefaultState());\n  },\n  SET_TOKEN: function SET_TOKEN(state, token) {\n    state.token = token;\n  },\n  SET_NAME: function SET_NAME(state, name) {\n    state.name = name;\n  },\n  SET_AVATAR: function SET_AVATAR(state, avatar) {\n    state.avatar = avatar;\n  },\n  SET_ROLES: function SET_ROLES(state, roles) {\n    state.roles = roles;\n  }\n};\nvar actions = {\n  // 登录\n  login: function login(_ref, userInfo) {\n    var commit = _ref.commit;\n    var username = userInfo.username,\n      password = userInfo.password;\n    return new Promise(function (resolve, reject) {\n      _login({\n        username: username.trim(),\n        password: password\n      }).then(function (response) {\n        var token = response.token,\n          _response$roles = response.roles,\n          roles = _response$roles === void 0 ? ['user'] : _response$roles; // 确保从登录响应中获取角色\n        commit('SET_TOKEN', token);\n        commit('SET_ROLES', roles); // 立即设置角色\n        setToken(token);\n        resolve(response);\n      })[\"catch\"](function (error) {\n        reject(error);\n      });\n    });\n  },\n  // 获取用户信息\n  getInfo: function getInfo(_ref2) {\n    var commit = _ref2.commit;\n    return new Promise(function (resolve, reject) {\n      _getInfo().then(function (response) {\n        if (!response) {\n          reject('验证失败，请重新登录');\n          return;\n        }\n        var _response$roles2 = response.roles,\n          roles = _response$roles2 === void 0 ? ['user'] : _response$roles2,\n          _response$name = response.name,\n          name = _response$name === void 0 ? '' : _response$name,\n          _response$avatar = response.avatar,\n          avatar = _response$avatar === void 0 ? '' : _response$avatar; // 设置默认值\n\n        // 确保 roles 是数组\n        var userRoles = Array.isArray(roles) ? roles : [roles];\n        if (!userRoles.length) {\n          reject('getInfo: roles must be a non-null array!');\n          return;\n        }\n        commit('SET_ROLES', userRoles);\n        commit('SET_NAME', name);\n        commit('SET_AVATAR', avatar);\n        resolve(_objectSpread(_objectSpread({}, response), {}, {\n          roles: userRoles\n        }));\n      })[\"catch\"](function (error) {\n        reject(error);\n      });\n    });\n  },\n  // 登出\n  logout: function logout(_ref3) {\n    var commit = _ref3.commit;\n    return new Promise(function (resolve, reject) {\n      try {\n        commit('RESET_STATE');\n        commit('SET_TOKEN', '');\n        commit('SET_ROLES', []);\n        removeToken();\n        resetRouter();\n        resolve();\n      } catch (error) {\n        reject(error);\n      }\n    });\n  },\n  // 重置 Token\n  resetToken: function resetToken(_ref4) {\n    var commit = _ref4.commit;\n    return new Promise(function (resolve) {\n      commit('RESET_STATE');\n      commit('SET_TOKEN', '');\n      commit('SET_ROLES', []);\n      removeToken();\n      resolve();\n    });\n  }\n};\nexport default {\n  namespaced: true,\n  state: state,\n  mutations: mutations,\n  actions: actions\n};","map":{"version":3,"names":["login","getInfo","getToken","setToken","removeToken","resetRouter","getDefaultState","token","name","avatar","roles","state","mutations","RESET_STATE","Object","assign","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","actions","_ref","userInfo","commit","username","password","Promise","resolve","reject","trim","then","response","_response$roles","error","_ref2","_response$roles2","_response$name","_response$avatar","userRoles","Array","isArray","length","_objectSpread","logout","_ref3","resetToken","_ref4","namespaced"],"sources":["C:/Users/ND/Desktop/Fixed_Project/frontend/src/store/modules/user.js"],"sourcesContent":["import { login, getInfo } from '@/api/user'\r\nimport { getToken, setToken, removeToken } from '@/utils/auth'\r\nimport { resetRouter } from '@/router'\r\n\r\nconst getDefaultState = () => {\r\n  return {\r\n    token: getToken(),\r\n    name: '',\r\n    avatar: '',\r\n    roles: [] // 初始为空数组\r\n  }\r\n}\r\n\r\nconst state = getDefaultState()\r\n\r\nconst mutations = {\r\n  RESET_STATE: (state) => {\r\n    Object.assign(state, getDefaultState())\r\n  },\r\n  SET_TOKEN: (state, token) => {\r\n    state.token = token\r\n  },\r\n  SET_NAME: (state, name) => {\r\n    state.name = name\r\n  },\r\n  SET_AVATAR: (state, avatar) => {\r\n    state.avatar = avatar\r\n  },\r\n  SET_ROLES: (state, roles) => {\r\n    state.roles = roles\r\n  }\r\n}\r\n\r\nconst actions = {\r\n  // 登录\r\n  login({ commit }, userInfo) {\r\n    const { username, password } = userInfo\r\n    return new Promise((resolve, reject) => {\r\n      login({ username: username.trim(), password: password })\r\n        .then(response => {\r\n          const { token, roles = ['user'] } = response  // 确保从登录响应中获取角色\r\n          commit('SET_TOKEN', token)\r\n          commit('SET_ROLES', roles)  // 立即设置角色\r\n          setToken(token)\r\n          resolve(response)\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 获取用户信息\r\n  getInfo({ commit }) {\r\n    return new Promise((resolve, reject) => {\r\n      getInfo()\r\n        .then(response => {\r\n          if (!response) {\r\n            reject('验证失败，请重新登录')\r\n            return\r\n          }\r\n\r\n          const { roles = ['user'], name = '', avatar = '' } = response  // 设置默认值\r\n          \r\n          // 确保 roles 是数组\r\n          const userRoles = Array.isArray(roles) ? roles : [roles]\r\n          \r\n          if (!userRoles.length) {\r\n            reject('getInfo: roles must be a non-null array!')\r\n            return\r\n          }\r\n\r\n          commit('SET_ROLES', userRoles)\r\n          commit('SET_NAME', name)\r\n          commit('SET_AVATAR', avatar)\r\n          resolve({ ...response, roles: userRoles })\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 登出\r\n  logout({ commit }) {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        commit('RESET_STATE')\r\n        commit('SET_TOKEN', '')\r\n        commit('SET_ROLES', [])\r\n        removeToken()\r\n        resetRouter()\r\n        resolve()\r\n      } catch (error) {\r\n        reject(error)\r\n      }\r\n    })\r\n  },\r\n\r\n  // 重置 Token\r\n  resetToken({ commit }) {\r\n    return new Promise(resolve => {\r\n      commit('RESET_STATE')\r\n      commit('SET_TOKEN', '')\r\n      commit('SET_ROLES', [])\r\n      removeToken()\r\n      resolve()\r\n    })\r\n  }\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  mutations,\r\n  actions\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}