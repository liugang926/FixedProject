{"ast":null,"code":"import \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { login as _login, logout as _logout, getInfo as _getInfo } from '@/api/user';\nimport { getToken, setToken, removeToken } from '@/utils/auth';\nimport router, { resetRouter } from '@/router';\nvar state = {\n  token: getToken(),\n  name: '',\n  avatar: '',\n  introduction: '',\n  roles: [],\n  permissions: []\n};\nvar mutations = {\n  SET_TOKEN: function SET_TOKEN(state, token) {\n    state.token = token;\n  },\n  SET_NAME: function SET_NAME(state, name) {\n    state.name = name;\n  },\n  SET_AVATAR: function SET_AVATAR(state, avatar) {\n    state.avatar = avatar;\n  },\n  SET_ROLES: function SET_ROLES(state, roles) {\n    state.roles = roles;\n  },\n  SET_PERMISSIONS: function SET_PERMISSIONS(state, permissions) {\n    state.permissions = permissions;\n  }\n};\nvar actions = {\n  // 用户登录\n  login: function login(_ref, userInfo) {\n    var commit = _ref.commit;\n    var username = userInfo.username,\n      password = userInfo.password;\n    return new Promise(function (resolve, reject) {\n      _login({\n        username: username.trim(),\n        password: password\n      }).then(function (response) {\n        var token = response.token;\n        commit('SET_TOKEN', token);\n        setToken(token);\n        resolve();\n      })[\"catch\"](function (error) {\n        reject(error);\n      });\n    });\n  },\n  // 获取用户信息\n  getInfo: function getInfo(_ref2) {\n    var commit = _ref2.commit,\n      dispatch = _ref2.dispatch;\n    return new Promise(function (resolve, reject) {\n      _getInfo().then(function (response) {\n        var role = response.role,\n          name = response.name,\n          avatar = response.avatar,\n          permissions = response.permissions;\n\n        // 设置用户信息\n        commit('SET_ROLES', [role]);\n        commit('SET_NAME', name);\n        commit('SET_AVATAR', avatar);\n        commit('SET_PERMISSIONS', permissions);\n\n        // 生成路由\n        dispatch('permission/generateRoutes', {\n          roles: [role],\n          permissions: permissions\n        }, {\n          root: true\n        }).then(function (accessRoutes) {\n          // 动态添加路由\n          accessRoutes.forEach(function (route) {\n            router.addRoute(route);\n          });\n          resolve(response);\n        });\n      })[\"catch\"](function (error) {\n        reject(error);\n      });\n    });\n  },\n  // 用户登出\n  logout: function logout(_ref3) {\n    var commit = _ref3.commit;\n    return new Promise(function (resolve, reject) {\n      _logout().then(function () {\n        commit('SET_TOKEN', '');\n        commit('SET_ROLES', []);\n        commit('SET_PERMISSIONS', []);\n        removeToken();\n        resetRouter();\n\n        // 重定向到登录页\n        router.push('/login');\n        resolve();\n      })[\"catch\"](function (error) {\n        reject(error);\n      });\n    });\n  },\n  // 重置 token\n  resetToken: function resetToken(_ref4) {\n    var commit = _ref4.commit;\n    return new Promise(function (resolve) {\n      commit('SET_TOKEN', '');\n      commit('SET_ROLES', []);\n      commit('SET_PERMISSIONS', []);\n      removeToken();\n      resetRouter();\n      resolve();\n    });\n  }\n};\nexport default {\n  namespaced: true,\n  state: state,\n  mutations: mutations,\n  actions: actions\n};","map":{"version":3,"names":["login","logout","getInfo","getToken","setToken","removeToken","router","resetRouter","state","token","name","avatar","introduction","roles","permissions","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","SET_PERMISSIONS","actions","_ref","userInfo","commit","username","password","Promise","resolve","reject","trim","then","response","error","_ref2","dispatch","role","root","accessRoutes","forEach","route","addRoute","_ref3","push","resetToken","_ref4","namespaced"],"sources":["C:/Users/ND/Desktop/Fixed_Project/frontend/src/store/modules/user.js"],"sourcesContent":["import { login, logout, getInfo } from '@/api/user'\r\nimport { getToken, setToken, removeToken } from '@/utils/auth'\r\nimport router, { resetRouter } from '@/router'\r\n\r\nconst state = {\r\n  token: getToken(),\r\n  name: '',\r\n  avatar: '',\r\n  introduction: '',\r\n  roles: [],\r\n  permissions: []\r\n}\r\n\r\nconst mutations = {\r\n  SET_TOKEN: (state, token) => {\r\n    state.token = token\r\n  },\r\n  SET_NAME: (state, name) => {\r\n    state.name = name\r\n  },\r\n  SET_AVATAR: (state, avatar) => {\r\n    state.avatar = avatar\r\n  },\r\n  SET_ROLES: (state, roles) => {\r\n    state.roles = roles\r\n  },\r\n  SET_PERMISSIONS: (state, permissions) => {\r\n    state.permissions = permissions\r\n  }\r\n}\r\n\r\nconst actions = {\r\n  // 用户登录\r\n  login({ commit }, userInfo) {\r\n    const { username, password } = userInfo\r\n    return new Promise((resolve, reject) => {\r\n      login({ username: username.trim(), password: password })\r\n        .then(response => {\r\n          const { token } = response\r\n          commit('SET_TOKEN', token)\r\n          setToken(token)\r\n          resolve()\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 获取用户信息\r\n  getInfo({ commit, dispatch }) {\r\n    return new Promise((resolve, reject) => {\r\n      getInfo()\r\n        .then(response => {\r\n          const { role, name, avatar, permissions } = response\r\n\r\n          // 设置用户信息\r\n          commit('SET_ROLES', [role])\r\n          commit('SET_NAME', name)\r\n          commit('SET_AVATAR', avatar)\r\n          commit('SET_PERMISSIONS', permissions)\r\n\r\n          // 生成路由\r\n          dispatch('permission/generateRoutes', {\r\n            roles: [role],\r\n            permissions: permissions\r\n          }, { root: true }).then(accessRoutes => {\r\n            // 动态添加路由\r\n            accessRoutes.forEach(route => {\r\n              router.addRoute(route)\r\n            })\r\n            resolve(response)\r\n          })\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 用户登出\r\n  logout({ commit }) {\r\n    return new Promise((resolve, reject) => {\r\n      logout()\r\n        .then(() => {\r\n          commit('SET_TOKEN', '')\r\n          commit('SET_ROLES', [])\r\n          commit('SET_PERMISSIONS', [])\r\n          removeToken()\r\n          resetRouter()\r\n          \r\n          // 重定向到登录页\r\n          router.push('/login')\r\n          resolve()\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 重置 token\r\n  resetToken({ commit }) {\r\n    return new Promise(resolve => {\r\n      commit('SET_TOKEN', '')\r\n      commit('SET_ROLES', [])\r\n      commit('SET_PERMISSIONS', [])\r\n      removeToken()\r\n      resetRouter()\r\n      resolve()\r\n    })\r\n  }\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  mutations,\r\n  actions\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}