{"ast":null,"code":"import { createRouter, createWebHistory } from 'vue-router';\nimport Layout from '@/views/layout/Layout.vue';\nimport { getToken } from '@/utils/auth';\nimport store from '@/store';\nconst routes = [{\n  path: '/login',\n  name: 'Login',\n  component: () => import('@/views/login/Login.vue')\n}, {\n  path: '/',\n  component: Layout,\n  redirect: '/dashboard',\n  children: [{\n    path: 'dashboard',\n    name: 'Dashboard',\n    component: () => import('@/views/dashboard/Dashboard.vue'),\n    meta: {\n      title: '仪表盘',\n      icon: 'Menu',\n      cache: true,\n      affix: true\n    }\n  }, {\n    path: 'assets',\n    name: 'Assets',\n    component: () => import('@/views/assets/AssetList.vue'),\n    meta: {\n      title: '资产管理',\n      icon: 'Document',\n      cache: true,\n      affix: false\n    }\n  }, {\n    path: 'users',\n    name: 'Users',\n    component: () => import('@/views/user/UserList.vue'),\n    meta: {\n      title: '用户管理',\n      icon: 'User',\n      roles: ['admin']\n    }\n  }]\n}];\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\nrouter.beforeEach(async (to, from, next) => {\n  const hasToken = getToken();\n  if (hasToken) {\n    if (to.path === '/login') {\n      next({\n        path: '/'\n      });\n    } else {\n      try {\n        const hasRoutes = store.state.permission.routes.length > 0;\n        if (hasRoutes) {\n          next();\n        } else {\n          await store.dispatch('user/getInfo');\n          await store.dispatch('permission/generateRoutes');\n          next({\n            ...to,\n            replace: true\n          });\n        }\n      } catch (error) {\n        await store.dispatch('user/resetToken');\n        next(`/login?redirect=${to.path}`);\n      }\n    }\n  } else {\n    if (to.path === '/login') {\n      next();\n    } else {\n      next(`/login?redirect=${to.path}`);\n    }\n  }\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","Layout","getToken","store","routes","path","name","component","redirect","children","meta","title","icon","cache","affix","roles","router","history","process","env","BASE_URL","beforeEach","to","from","next","hasToken","hasRoutes","state","permission","length","dispatch","replace","error"],"sources":["C:/Users/ND/Desktop/Fixed_Project/frontend/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\r\nimport Layout from '@/views/layout/Layout.vue'\r\nimport { getToken } from '@/utils/auth'\r\nimport store from '@/store'\r\n\r\nconst routes = [\r\n  {\r\n    path: '/login',\r\n    name: 'Login',\r\n    component: () => import('@/views/login/Login.vue')\r\n  },\r\n  {\r\n    path: '/',\r\n    component: Layout,\r\n    redirect: '/dashboard',\r\n    children: [\r\n      {\r\n        path: 'dashboard',\r\n        name: 'Dashboard',\r\n        component: () => import('@/views/dashboard/Dashboard.vue'),\r\n        meta: { title: '仪表盘', icon: 'Menu', cache: true, affix: true }\r\n      },\r\n      {\r\n        path: 'assets',\r\n        name: 'Assets',\r\n        component: () => import('@/views/assets/AssetList.vue'),\r\n        meta: { title: '资产管理', icon: 'Document', cache: true, affix: false }\r\n      },\r\n      {\r\n        path: 'users',\r\n        name: 'Users',\r\n        component: () => import('@/views/user/UserList.vue'),\r\n        meta: { title: '用户管理', icon: 'User', roles: ['admin'] }\r\n      }\r\n    ]\r\n  }\r\n]\r\n\r\nconst router = createRouter({\r\n  history: createWebHistory(process.env.BASE_URL),\r\n  routes\r\n})\r\n\r\nrouter.beforeEach(async (to, from, next) => {\r\n  const hasToken = getToken()\r\n\r\n  if (hasToken) {\r\n    if (to.path === '/login') {\r\n      next({ path: '/' })\r\n    } else {\r\n      try {\r\n        const hasRoutes = store.state.permission.routes.length > 0\r\n        if (hasRoutes) {\r\n          next()\r\n        } else {\r\n          await store.dispatch('user/getInfo')\r\n          await store.dispatch('permission/generateRoutes')\r\n          next({ ...to, replace: true })\r\n        }\r\n      } catch (error) {\r\n        await store.dispatch('user/resetToken')\r\n        next(`/login?redirect=${to.path}`)\r\n      }\r\n    }\r\n  } else {\r\n    if (to.path === '/login') {\r\n      next()\r\n    } else {\r\n      next(`/login?redirect=${to.path}`)\r\n    }\r\n  }\r\n})\r\n\r\nexport default router "],"mappings":"AAAA,SAASA,YAAY,EAAEC,gBAAgB,QAAQ,YAAY;AAC3D,OAAOC,MAAM,MAAM,2BAA2B;AAC9C,SAASC,QAAQ,QAAQ,cAAc;AACvC,OAAOC,KAAK,MAAM,SAAS;AAE3B,MAAMC,MAAM,GAAG,CACb;EACEC,IAAI,EAAE,QAAQ;EACdC,IAAI,EAAE,OAAO;EACbC,SAAS,EAAEA,CAAA,KAAM,MAAM,CAAC,yBAAyB;AACnD,CAAC,EACD;EACEF,IAAI,EAAE,GAAG;EACTE,SAAS,EAAEN,MAAM;EACjBO,QAAQ,EAAE,YAAY;EACtBC,QAAQ,EAAE,CACR;IACEJ,IAAI,EAAE,WAAW;IACjBC,IAAI,EAAE,WAAW;IACjBC,SAAS,EAAEA,CAAA,KAAM,MAAM,CAAC,iCAAiC,CAAC;IAC1DG,IAAI,EAAE;MAAEC,KAAK,EAAE,KAAK;MAAEC,IAAI,EAAE,MAAM;MAAEC,KAAK,EAAE,IAAI;MAAEC,KAAK,EAAE;IAAK;EAC/D,CAAC,EACD;IACET,IAAI,EAAE,QAAQ;IACdC,IAAI,EAAE,QAAQ;IACdC,SAAS,EAAEA,CAAA,KAAM,MAAM,CAAC,8BAA8B,CAAC;IACvDG,IAAI,EAAE;MAAEC,KAAK,EAAE,MAAM;MAAEC,IAAI,EAAE,UAAU;MAAEC,KAAK,EAAE,IAAI;MAAEC,KAAK,EAAE;IAAM;EACrE,CAAC,EACD;IACET,IAAI,EAAE,OAAO;IACbC,IAAI,EAAE,OAAO;IACbC,SAAS,EAAEA,CAAA,KAAM,MAAM,CAAC,2BAA2B,CAAC;IACpDG,IAAI,EAAE;MAAEC,KAAK,EAAE,MAAM;MAAEC,IAAI,EAAE,MAAM;MAAEG,KAAK,EAAE,CAAC,OAAO;IAAE;EACxD,CAAC;AAEL,CAAC,CACF;AAED,MAAMC,MAAM,GAAGjB,YAAY,CAAC;EAC1BkB,OAAO,EAAEjB,gBAAgB,CAACkB,OAAO,CAACC,GAAG,CAACC,QAAQ,CAAC;EAC/ChB;AACF,CAAC,CAAC;AAEFY,MAAM,CAACK,UAAU,CAAC,OAAOC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EAC1C,MAAMC,QAAQ,GAAGvB,QAAQ,CAAC,CAAC;EAE3B,IAAIuB,QAAQ,EAAE;IACZ,IAAIH,EAAE,CAACjB,IAAI,KAAK,QAAQ,EAAE;MACxBmB,IAAI,CAAC;QAAEnB,IAAI,EAAE;MAAI,CAAC,CAAC;IACrB,CAAC,MAAM;MACL,IAAI;QACF,MAAMqB,SAAS,GAAGvB,KAAK,CAACwB,KAAK,CAACC,UAAU,CAACxB,MAAM,CAACyB,MAAM,GAAG,CAAC;QAC1D,IAAIH,SAAS,EAAE;UACbF,IAAI,CAAC,CAAC;QACR,CAAC,MAAM;UACL,MAAMrB,KAAK,CAAC2B,QAAQ,CAAC,cAAc,CAAC;UACpC,MAAM3B,KAAK,CAAC2B,QAAQ,CAAC,2BAA2B,CAAC;UACjDN,IAAI,CAAC;YAAE,GAAGF,EAAE;YAAES,OAAO,EAAE;UAAK,CAAC,CAAC;QAChC;MACF,CAAC,CAAC,OAAOC,KAAK,EAAE;QACd,MAAM7B,KAAK,CAAC2B,QAAQ,CAAC,iBAAiB,CAAC;QACvCN,IAAI,CAAC,mBAAmBF,EAAE,CAACjB,IAAI,EAAE,CAAC;MACpC;IACF;EACF,CAAC,MAAM;IACL,IAAIiB,EAAE,CAACjB,IAAI,KAAK,QAAQ,EAAE;MACxBmB,IAAI,CAAC,CAAC;IACR,CAAC,MAAM;MACLA,IAAI,CAAC,mBAAmBF,EAAE,CAACjB,IAAI,EAAE,CAAC;IACpC;EACF;AACF,CAAC,CAAC;AAEF,eAAeW,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}