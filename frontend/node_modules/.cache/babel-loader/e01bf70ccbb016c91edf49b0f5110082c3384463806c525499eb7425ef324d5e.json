{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/ND/Desktop/Fixed_Project/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _objectSpread from \"C:/Users/ND/Desktop/Fixed_Project/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"C:/Users/ND/Desktop/Fixed_Project/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.is-array.js\";\nimport \"core-js/modules/es.array.some.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport { createRouter, createWebHistory } from 'vue-router';\nimport Layout from '@/views/layout/Layout.vue';\nimport { getToken } from '@/utils/auth';\nimport store from '@/store';\nvar routes = [{\n  path: '/login',\n  name: 'Login',\n  component: function component() {\n    return import('@/views/login/Login.vue');\n  }\n}, {\n  path: '/',\n  component: Layout,\n  redirect: '/dashboard',\n  children: [{\n    path: 'dashboard',\n    name: 'Dashboard',\n    component: function component() {\n      return import('@/views/dashboard/Dashboard.vue');\n    },\n    meta: {\n      title: '仪表盘',\n      icon: 'Menu',\n      cache: true,\n      affix: true\n    }\n  }, {\n    path: 'assets',\n    name: 'Assets',\n    component: function component() {\n      return import('@/views/assets/AssetList.vue');\n    },\n    meta: {\n      title: '资产管理',\n      icon: 'Document',\n      cache: true,\n      affix: false\n    }\n  }, {\n    path: 'users',\n    name: 'Users',\n    component: function component() {\n      return import('@/views/user/index.vue');\n    },\n    meta: {\n      title: '用户管理',\n      icon: 'User',\n      roles: ['admin']\n    }\n  }]\n}];\nvar router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes: routes\n});\nrouter.beforeEach(/*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(to, from, next) {\n    var hasToken, userRoles, hasRoles, hasPermission, _yield$store$dispatch, _yield$store$dispatch2, roles, _hasPermission;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          hasToken = getToken();\n          if (!hasToken) {\n            _context.next = 41;\n            break;\n          }\n          if (!(to.path === '/login')) {\n            _context.next = 6;\n            break;\n          }\n          next({\n            path: '/'\n          });\n          _context.next = 39;\n          break;\n        case 6:\n          _context.prev = 6;\n          // 确保 roles 存在且是数组\n          userRoles = store.state.user.roles || ['user'];\n          hasRoles = Array.isArray(userRoles) && userRoles.length > 0;\n          if (!hasRoles) {\n            _context.next = 18;\n            break;\n          }\n          if (!(to.meta.roles && to.meta.roles.length > 0)) {\n            _context.next = 15;\n            break;\n          }\n          hasPermission = userRoles.some(function (role) {\n            return to.meta.roles.includes(role);\n          });\n          if (hasPermission) {\n            _context.next = 15;\n            break;\n          }\n          next('/403');\n          return _context.abrupt(\"return\");\n        case 15:\n          next();\n          _context.next = 31;\n          break;\n        case 18:\n          _context.next = 20;\n          return store.dispatch('user/getInfo');\n        case 20:\n          _yield$store$dispatch = _context.sent;\n          _yield$store$dispatch2 = _yield$store$dispatch.roles;\n          roles = _yield$store$dispatch2 === void 0 ? ['user'] : _yield$store$dispatch2;\n          _context.next = 25;\n          return store.dispatch('permission/generateRoutes', roles);\n        case 25:\n          if (!(to.meta.roles && to.meta.roles.length > 0)) {\n            _context.next = 30;\n            break;\n          }\n          _hasPermission = roles.some(function (role) {\n            return to.meta.roles.includes(role);\n          });\n          if (_hasPermission) {\n            _context.next = 30;\n            break;\n          }\n          next('/403');\n          return _context.abrupt(\"return\");\n        case 30:\n          next(_objectSpread(_objectSpread({}, to), {}, {\n            replace: true\n          }));\n        case 31:\n          _context.next = 39;\n          break;\n        case 33:\n          _context.prev = 33;\n          _context.t0 = _context[\"catch\"](6);\n          console.error('Route Error:', _context.t0);\n          _context.next = 38;\n          return store.dispatch('user/resetToken');\n        case 38:\n          next(\"/login?redirect=\".concat(to.path));\n        case 39:\n          _context.next = 42;\n          break;\n        case 41:\n          if (to.path === '/login') {\n            next();\n          } else {\n            next(\"/login?redirect=\".concat(to.path));\n          }\n        case 42:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee, null, [[6, 33]]);\n  }));\n  return function (_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}());\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","Layout","getToken","store","routes","path","name","component","redirect","children","meta","title","icon","cache","affix","roles","router","history","process","env","BASE_URL","beforeEach","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","to","from","next","hasToken","userRoles","hasRoles","hasPermission","_yield$store$dispatch","_yield$store$dispatch2","_hasPermission","wrap","_callee$","_context","prev","state","user","Array","isArray","length","some","role","includes","abrupt","dispatch","sent","_objectSpread","replace","t0","console","error","concat","stop","_x","_x2","_x3","apply","arguments"],"sources":["C:/Users/ND/Desktop/Fixed_Project/frontend/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\r\nimport Layout from '@/views/layout/Layout.vue'\r\nimport { getToken } from '@/utils/auth'\r\nimport store from '@/store'\r\n\r\nconst routes = [\r\n  {\r\n    path: '/login',\r\n    name: 'Login',\r\n    component: () => import('@/views/login/Login.vue')\r\n  },\r\n  {\r\n    path: '/',\r\n    component: Layout,\r\n    redirect: '/dashboard',\r\n    children: [\r\n      {\r\n        path: 'dashboard',\r\n        name: 'Dashboard',\r\n        component: () => import('@/views/dashboard/Dashboard.vue'),\r\n        meta: { title: '仪表盘', icon: 'Menu', cache: true, affix: true }\r\n      },\r\n      {\r\n        path: 'assets',\r\n        name: 'Assets',\r\n        component: () => import('@/views/assets/AssetList.vue'),\r\n        meta: { title: '资产管理', icon: 'Document', cache: true, affix: false }\r\n      },\r\n      {\r\n        path: 'users',\r\n        name: 'Users',\r\n        component: () => import('@/views/user/index.vue'),\r\n        meta: { title: '用户管理', icon: 'User', roles: ['admin'] }\r\n      }\r\n    ]\r\n  }\r\n]\r\n\r\nconst router = createRouter({\r\n  history: createWebHistory(process.env.BASE_URL),\r\n  routes\r\n})\r\n\r\nrouter.beforeEach(async (to, from, next) => {\r\n  const hasToken = getToken()\r\n\r\n  if (hasToken) {\r\n    if (to.path === '/login') {\r\n      next({ path: '/' })\r\n    } else {\r\n      try {\r\n        // 确保 roles 存在且是数组\r\n        const userRoles = store.state.user.roles || ['user']\r\n        const hasRoles = Array.isArray(userRoles) && userRoles.length > 0\r\n\r\n        if (hasRoles) {\r\n          // 检查是否有权限访问\r\n          if (to.meta.roles && to.meta.roles.length > 0) {\r\n            const hasPermission = userRoles.some(role => \r\n              to.meta.roles.includes(role)\r\n            )\r\n            if (!hasPermission) {\r\n              next('/403')\r\n              return\r\n            }\r\n          }\r\n          next()\r\n        } else {\r\n          // 获取用户信息\r\n          const { roles = ['user'] } = await store.dispatch('user/getInfo')\r\n          \r\n          // 根据角色生成路由\r\n          await store.dispatch('permission/generateRoutes', roles)\r\n          \r\n          // 检查权限\r\n          if (to.meta.roles && to.meta.roles.length > 0) {\r\n            const hasPermission = roles.some(role => \r\n              to.meta.roles.includes(role)\r\n            )\r\n            if (!hasPermission) {\r\n              next('/403')\r\n              return\r\n            }\r\n          }\r\n          next({ ...to, replace: true })\r\n        }\r\n      } catch (error) {\r\n        console.error('Route Error:', error)\r\n        await store.dispatch('user/resetToken')\r\n        next(`/login?redirect=${to.path}`)\r\n      }\r\n    }\r\n  } else {\r\n    if (to.path === '/login') {\r\n      next()\r\n    } else {\r\n      next(`/login?redirect=${to.path}`)\r\n    }\r\n  }\r\n})\r\n\r\nexport default router "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}